promise.ajaxTimeout=15e3,window.$=function(n){return document.getElementById(n.slice(1))},window.JSON||(window.JSON={parse:function(sJSON){return eval("("+sJSON+")")}}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),String.prototype.supplant||(String.prototype.supplant=function(n){return this.replace(/\{([^{}]*)\}/g,function(e,o){var t=n[o];return"string"==typeof t||"number"==typeof t?t:e})});var notes=function(){var n="",e=!1,o=function(n,e){var o=RegExp("(?:^|\\s)"+e+"(?!\\S)");return null!=n.className.match(o)},t=function(n,e){o(n,e)||(n.className=n.className+" "+e)},r=function(n,e){if(n.className){var o=RegExp("(?:^|\\s)"+e+"(?!\\S)","g");n.className=n.className.replace(o,"")}},a=function(n){r(n,"hidden")},s=function(n){t(n,"hidden")},_=function(n){o(n,"hidden")?a(n):s(n)},c=function(n,e,o){window.addEventListener?n.addEventListener(e,o,!1):"click"==e?n.onclick=o:"submit"==e?n.onsubmit=o:"keyup"==e?n.onkeyup=o:"keydown"==e?n.onkeydown=o:"keypress"==e?n.onkeypress=o:"hashchange"==e&&(n.onhashchange=o)},d=function(n,e){null!=n.innerText?n.innerText=e:n.textContent=e},l=function(n){function o(n){var e=new promise.Promise;return setTimeout(function(){e.done(null,n)},n),e}null!=n&&(e||o(50).then(function(e,t){return n.focus(),o(t)}))},u=function(n){function o(n){var e=new promise.Promise;return setTimeout(function(){e.done(null,n)},n),e}e||o(50).then(function(e,t){return n.focus(),o(t)}).then(function(e,o){try{n.setSelectionRange(0,n.value.length)}catch(e){n.select(0,9999999)}})},p=function(){document.body.scrollTop=document.documentElement.scrollTop=0},m=function(n,e){if(null!=$(n)){var o=new Date,t=(e-o)/1e3;$(n).innerHTML=function(n){var e,o={};if(n>172800)o.days=parseInt(n/86400),e=i18n_tpl.expires_d;else if(n>7200){var t=parseInt(n/3600);o.hours=t,o.minutes=parseInt((n-3600*t)/60),e=i18n_tpl.expires_h_m}else if(n>120){var r=parseInt(n/60);o.minutes=r,o.seconds=parseInt(n-60*r),e=i18n_tpl.expires_m_s}else o.seconds=n>=0?parseInt(n):0,e=i18n_tpl.expires_s;return e.supplant(o)}(t);var r=1e3;r=t>172800?36e5:t>7200?6e4:1e3,setTimeout(function(){m(n,e)},r)}},f=function(n,e){hash=location.hash.substring(1),options=hash.split("&");var o={};for(i in options){var t=options[i].split("=");""!=t[0]&&(o[t[0]]=t[1]||"")}o[n]=e?encodeURI(e):"";var r=[];for(k in o){var a=k;""!=o[k]&&(a+="="+o[k]),r.push(a)}location.hash=r.join("&")},h=function(n){var e=location.hash.substring(1).split("&"),o=[];for(var t in e){var r=RegExp("^"+n+"$"),i=RegExp("^"+n+"=");null==e[t].match(r)&&null==e[t].match(i)&&(""!=e[t]&&o.push(e[t]))}location.hash=o.join("&")},v=null,w=null,y=null;return{init_create:function(){function n(){var n=location.hash.trim();if(n&&!(n.length<2)){var e=!1,t=n.substring(1).split("&");for(i in t){var r=t[i].split("=");switch(r[0]){case"dont_ask":$("#destroy_without_confirmation").checked=!0,e=!0;break;case"duration_hours":$("#duration_hours").value=r[1]||0,e=!0;break;case"notify_email_e":var _=common.urldemangle(decodeURI(r[1]))||"";common.is_email(_)&&($("#notify_email").value=_,e=!0);break;case"notify_ref_e":$("#notify_ref").value=common.urldemangle(decodeURI(r[1]))||"",e=!0}}0==$("#duration_hours").value?a($("#confirmation_option")):(s($("#confirmation_option")),h("dont_ask"),$("#destroy_without_confirmation").checked=!1),e&&o($("#advanced_options"),"hidden")?(a($("#options_on_notice")),a($("#options_on_notice_asterisk"))):(s($("#options_on_notice")),s($("#options_on_notice_asterisk"))),e?a($("#advanced_options_tip")):s($("#advanced_options_tip"))}}-1==document.cookie.indexOf("cookieconsent_status=dissmiss")&&r($("#cookie-modal"),"hidden"),c($("#cookie_consent"),"click",function(){document.cookie="cookieconsent_status=dissmiss",t(document.getElementById("cookie-modal"),"hidden")}),c($("#new_note_help_toggle"),"click",function(n){_($("#new_note_help"))}),c($("#created_note_help_toggle"),"click",function(n){_($("#created_note_help")),w&&_($("#created_note_with_pass_help"))}),c($("#advanced_options_show"),"click",function(n){a($("#advanced_options")),a($("#advanced_options_hide")),s($("#advanced_options_show")),s($("#options_on_notice")),s($("#options_on_notice_asterisk")),l($("#duration_hours"))}),c($("#advanced_options_hide"),"click",function(n){s($("#advanced_options")),s($("#advanced_options_hide")),a($("#advanced_options_show")),$("#duration_hours").value=0,$("#destroy_without_confirmation").checked=!1,a($("#confirmation_option")),$("#manual_password").value="",$("#manual_password_confirm").value="",$("#notify_email").value="",$("#notify_ref").value="",s($("#error_ajax")),s($("#error_connection")),s($("#error_note_is_empty")),s($("#error_password_mismatch")),s($("#error_notify_email_invalid"));var e=["very_weak","weak","good","strong","very_strong"];for(var o in e)s($("#"+e[o]+"_manual_password"));location.hash="",s($("#options_on_notice")),s($("#options_on_notice_asterisk")),s($("#advanced_options_tip")),l($("#note_raw"))}),c($("#manual_password"),"keyup",function(n){var e=common.pass_strength($("#manual_password").value),o=["very_weak","weak","good","strong","very_strong"];for(var t in o)s($("#"+o[t]+"_manual_password"));$("#manual_password").value&&a($("#"+e+"_manual_password")),$("#manual_password").value&&$("#manual_password_confirm").value&&$("#manual_password").value!=$("#manual_password_confirm").value?a($("#error_password_mismatch")):s($("#error_password_mismatch"))}),c($("#manual_password_confirm"),"keyup",function(n){$("#manual_password").value&&$("#manual_password_confirm").value&&$("#manual_password").value!=$("#manual_password_confirm").value?a($("#error_password_mismatch")):s($("#error_password_mismatch"))}),c($("#notify_email"),"keyup",function(n){""!=$("#notify_email").value?(common.is_email($("#notify_email").value.trim())?s($("#error_notify_email_invalid")):a($("#error_notify_email_invalid")),f("notify_email_e",common.urlmangle($("#notify_email").value.trim()))):(s($("#error_notify_email_invalid")),h("notify_email_e"))}),c($("#notify_ref"),"keyup",function(n){""!=$("#notify_ref").value.trim()?f("notify_ref_e",common.urlmangle($("#notify_ref").value.trim())):h("notify_ref_e")}),$("#note_link_input")&&c($("#select_link"),"click",function(n){u($("#note_link_input"))}),$("#note_link_a")&&c($("#note_link_a"),"click",function(n){!function(n){n&&n.preventDefault?n.preventDefault():window.event&&(window.event.returnValue=!1)}(n)}),$("#note_password_input")&&c($("#select_password"),"click",function(n){u($("#note_password_input"))}),$("#show_password")&&(c($("#show_password"),"click",function(n){a($("#hide_password")),s($("#show_password")),e?d($("#note_password_span"),w):($("#note_password_input").value=w,a($("#select_password")))}),c($("#hide_password"),"click",function(n){s($("#hide_password")),a($("#show_password")),e?d($("#note_password_span"),"*******"):($("#note_password_input").value="*******",s($("#select_password")))})),c($("#encrypt_note"),"click",function(n){var o;$("#encrypt_note").disabled=!0;var t=$("#manual_password").value;w=t,o=""==t?common.make_password():t,s($("#error_ajax")),s($("#error_connection")),s($("#error_note_is_empty")),s($("#error_notify_email_invalid"));var r=!1,i=!1,_=$("#note_raw").value;if(""==_&&(a($("#error_note_is_empty")),r=!0),$("#manual_password").value!=$("#manual_password_confirm").value&&(a($("#error_password_mismatch")),i=!0),""!=$("#notify_email").value&&(common.is_email($("#notify_email").value.trim())||(a($("#error_notify_email_invalid")),i=!0)),i&&(a($("#advanced_options")),a($("#advanced_options_hide")),s($("#advanced_options_show")),s($("#advanced_options_tip"))),i||r)$("#encrypt_note").disabled=!1;else{p(),s($("#new_note")),a($("#creating_note"));var c=common.encrypt(_,o);o.length!=common.auto_pass_length&&(o=common.mangle(o)),v={data:c,has_manual_pass:""!=t,duration_hours:$("#duration_hours").value,dont_ask:$("#destroy_without_confirmation").checked,data_type:"T",notify_email:$("#notify_email").value.trim(),notify_ref:$("#notify_ref").value,hash:o},promise.post("//secretroom7.com/legacy/",v,{"X-Requested-With":"XMLHttpRequest"}).then(function(n,r,i){if(n){a($("#error_connection")),a($("#new_note")),s($("#creating_note")),s($("#created_note"));try{var _=(c=JSON.parse(r)).error;_&&(s($("#error_connection")),a($("#error_ajax")),$("#error_ajax").innerHTML=_)}catch(n){}$("#encrypt_note").disabled=!1}else{var c=JSON.parse(r);if($("#mailto_link").href="mailto:?body="+c.note_link,$("#show_link").href=c.note_link,$("#destroy_link").href=c.note_link,e?($("#note_link_a").href=c.note_link,$("#note_link_a").innerHTML=c.note_link):$("#note_link_input").value=c.note_link,""!=t)e?d($("#note_password_span"),"*******"):$("#note_password_input").value="******",a($("#note_password_block"));else{var l="#"+o;$("#mailto_link").href=$("#mailto_link").href+l,$("#show_link").href=$("#show_link").href+l,$("#destroy_link").href=$("#destroy_link").href+l,e?($("#note_link_a").href+=l,$("#note_link_a").innerHTML+=l):$("#note_link_input").value+=l}if(1==c.policy)a($("#destroy_link")),a($("#info_read_once"));else{var p=new Date(c.expires_js);m("#info_expires_text",p),a($("#info_expires")),a($("#show_link"))}$("#note_raw").value="",$("#manual_password").value="",s($("#new_note")),s($("#creating_note")),a($("#created_note")),e||u($("#note_link_input")),$("#encrypt_note").disabled=!1}})}}),c($("#destroy_without_confirmation"),"click",function(n){$("#destroy_without_confirmation").checked?f("dont_ask"):h("dont_ask")}),c($("#duration_hours"),"change",function(n){var e=$("#duration_hours").value;0==e?(h("duration_hours"),a($("#confirmation_option"))):(f("duration_hours",e),h("dont_ask"),$("#destroy_without_confirmation").checked=!1,s($("#confirmation_option")))}),h("notify_email"),h("notify_ref"),n(),c(window,"hashchange",function(e){n()}),a($("#content")),s($("#unsupported")),l($("#note_raw"))},init_read:function(o,i,f,h,v){function w(){try{var n,t=function(){var n="",e=!0;if($("#note_password")&&""!=$("#note_password").value)n=$("#note_password").value,e=!1;else if($("#note_link_manual")&&""!=$("#note_link_manual").value){var o=RegExp("#([^#]+)$");n=$("#note_link_manual").value.match(o)[1]}else y&&(n=y);return e&&n.length!=common.auto_pass_length&&(n=common.demangle(n)),n}();if(""==t)return a($("#password_form")),a($("#error_password_incorrect")),s($("#ok_content")),void l($("#note_password"));n=$("#note_contents").value;var r=common.decrypt(n,t);s($("#password_form")),s($("#error_password_incorrect")),a(1==i||2==o?$("#info_destroyed"):$("#info_expires")),a($("#ok_content")),y&&($("#note_link").href+="#"+y,$("#note_link").innerHTML+="#"+y),$("#note_contents").value=r,e?d($("#note_contents_div"),r):(a($("#note_contents")),u($("#note_contents")))}catch(n){a($("#password_form")),a($("#error_password_incorrect")),s($("#ok_content")),l($("#note_password"))}}function k(e,o,t){if(e){a($("#confirm_read_note")),s($("#fetching_note")),a($("#error_connection_read"));try{var r=(i=JSON.parse(o)).error;r&&(s($("#error_connection_read")),a($("#error_ajax_read")),$("#error_ajax_read").innerHTML=r)}catch(n){}return $("#confirm_button").disabled=!1,void l($("#confirm_button"))}var i;(i=JSON.parse(o)).data&&""!=i.data?($("#note_contents").value=i.data,""==y||f?(s($("#fetching_note")),a($("#read_note")),a($("#password_form")),s($("#error_password_incorrect")),s($("#ok_content")),l($("#note_password"))):(s($("#fetching_note")),a($("#read_note")),w(),s($("#error_password_incorrect"))),p()):location.href="/"+n}-1==document.cookie.indexOf("cookieconsent_status=dissmiss")&&r($("#cookie-modal"),"hidden"),$("#manual_password_help_toggle")&&c($("#manual_password_help_toggle"),"click",function(n){_($("#manual_password_help"))}),$("#note_password")&&c($("#note_password"),"keypress",function(n){n||(n=window.event),"13"==(n.keyCode||n.which)&&w()}),c($("#decrypt_button"),"click",function(n){w()}),c($("#cookie_consent"),"click",function(){document.cookie="cookieconsent_status=dissmiss",t(document.getElementById("cookie-modal"),"hidden")}),$("#select_text")&&c($("#select_text"),"click",function(n){u($("#note_contents"))}),$("#destroy_button")&&c($("#destroy_button"),"click",function(e){$("#destroy_button").disabled=!0,s($("#error_connection_destroy")),s($("#error_ajax_destroy")),promise.del("/"+n,null,{"X-Requested-With":"XMLHttpRequest"}).then(function(n,e,o){if(n){a($("#error_connection_destroy"));try{var t=JSON.parse(e).error;t&&(s($("#error_connection_destroy")),a($("#error_ajax_destroy")),$("#error_ajax_destroy").innerHTML=t)}catch(n){}$("#destroy_button").disabled=!1}else s($("#destroy_button")),s($("#info_expires")),a($("#info_destroyed"))})}),v&&m("#info_expires_text",new Date(v)),location.hash&&(y=location.hash.substring(1),location.hash=""),1==i?(c($("#confirm_button"),"click",function(e){$("#confirm_button").disabled=!0,s($("#confirm_read_note")),a($("#fetching_note")),s($("#error_connection_read")),s($("#error_ajax_read")),promise.del("/"+n,null,{"X-Requested-With":"XMLHttpRequest"}).then(k)}),f||""!=y?h?(s($("#confirm_read_note")),a($("#fetching_note")),s($("#error_connection_read")),s($("#error_ajax_read")),promise.del("/"+n,null,{"X-Requested-With":"XMLHttpRequest"}).then(k)):(a($("#confirm_read_note")),l($("#confirm_button"))):(s($("#link_ok")),a($("#error_link_incomplete")))):""==y||f?(s($("#confirm_read_note")),a($("#read_note")),a($("#password_form")),s($("#error_password_incorrect")),s($("#ok_content")),l($("#note_password"))):(a($("#read_note")),w()),a($("#content")),s($("#unsupported"))},init_error:function(){a($("#content")),s($("#unsupported"))},set_note_id:function(e){n=e},set_device_type:function(n){e="desktop"!=n},when_ready:function(n){var e=!1;function o(){e||(e=!0,n())}document.addEventListener?(document.addEventListener("DOMContentLoaded",o,!1),window.addEventListener("load",o,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",o),window.attachEvent("onload",o))}}}();
